<!DOCTYPE html>
<html lang="az">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seka Oyunu - Premium Casino</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/6.0.1/signalr.min.js"></script>
    <link rel="stylesheet" href="./seka.css">
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ğŸƒ SEKA PREMIUM ğŸƒ</h1>
            <div class="header-subtitle">PROFESSIONAL CARD GAME</div>
        </div>

        <div class="user-info">
            <div><strong id="userName">YÃ¼klÉ™nir...</strong></div>
            <div class="balance">ğŸ’° <span id="userBalance">0</span> â‚¼</div>
        </div>

        <div class="quick-join-section">
            <h2 style="color: #ffd700; margin-bottom: 15px;">âš¡ Tez QoÅŸul</h2>
            <p style="color: #94a3b8; margin-bottom: 20px;">GiriÅŸ haqqÄ± seÃ§in vÉ™ avtomatik uyÄŸun otaÄŸa qoÅŸulun!</p>
            <div id="quickJoinGrid" class="quick-join-grid">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>

        <div id="roomListSection" class="room-list-section">
            <h2 style="color: #ffd700; margin-bottom: 15px;">ğŸ® BÃ¼tÃ¼n Otaqlar</h2>
            <div class="room-grid" id="roomGrid">
                <div class="loading">
                    <div class="spinner"></div>Otaqlar yÃ¼klÉ™nir...
                </div>
            </div>
        </div>

        <div id="gameSection" class="game-section">
            <div style="margin-bottom: 20px;">
                <h2>Otaq: <span id="currentRoomName">-</span></h2>
            </div>

            <div class="poker-table" id="pokerTable">
                <div class="table-center">
                    <div class="pot-amount">POT: <span id="potAmount">0</span> â‚¼</div>
                    <div class="current-bet">Cari mÉ™rc: <span id="currentBetAmount">0</span> â‚¼</div>
                </div>
            </div>

            <div class="hand-cards" id="handCards"></div>

            <div class="actions">
                <button class="btn btn-fold" id="foldBtn" disabled>Fold</button>
                <button class="btn btn-call" id="callBtn" disabled>
                    Call (<span id="callAmount">0</span> â‚¼)
                </button>
                <button class="btn btn-call" id="checkBtn" disabled style="background: #3b82f6;">Check</button>
                <button class="btn" id="allInBtn" disabled style="background: #f59e0b; color: #fff;">All-In ğŸ”¥</button>
                <div style="display: flex; gap: 10px;">
                    <input type="number" id="raiseInput" class="bet-input" placeholder="MÉ™blÉ™ÄŸ" min="0" step="10"
                        disabled>
                    <button class="btn btn-raise" id="raiseBtn" disabled>Raise</button>
                </div>
                <button class="btn" id="showdownBtn" disabled style="background: #8b5cf6; color: #fff;">Showdown
                    ğŸ´</button>
                <button class="btn btn-leave" id="leaveBtn">Ã‡Ä±x</button>
            </div>

            <div class="players-list">
                <h3>OyunÃ§ular</h3>
                <div id="playersList"></div>
            </div>
        </div>
    </div>

    <div class="redirect-overlay" id="redirectOverlay">
        <div class="redirect-content">
            <h2>ğŸ”„ YÃ¶nlÉ™ndirmÉ™</h2>
            <p id="redirectMessage" style="color: #fff; font-size: 1.2rem;"></p>
            <div class="spinner"></div>
        </div>
    </div>

    <div class="showdown-overlay" id="showdownOverlay">
        <div class="showdown-content">
            <div class="showdown-title">ğŸ´ SHOWDOWN ğŸ´</div>
            <div class="showdown-players" id="showdownPlayers"></div>
            <div class="showdown-winner-announce" id="showdownWinner"></div>
            <button class="showdown-close-btn" onclick="closeShowdown()">Davam et</button>
        </div>
    </div>

    <script>


        let currentUserToken = null;
        let currentUserData = null;

        console.log('ğŸƒ [SEKA] Script yÃ¼klÉ™ndi');

        window.addEventListener('message', (event) => {
            console.log('ğŸ“¨ [SEKA] Message alÄ±ndÄ±:', event.data);

            if (event.data && event.data.type === 'INIT_USER') {
                console.log('âœ… [SEKA] INIT_USER qÉ™bul edildi');

                currentUserData = event.data.payload;
                currentUserToken = currentUserData.token;

                console.log('ğŸ‘¤ [SEKA] User:', currentUserData.username);
                console.log('ğŸ« [SEKA] Token:', currentUserToken ? 'VAR' : 'YOX');

                // UI-Ä± yenilÉ™
                document.getElementById('userName').textContent = currentUserData.username;
                document.getElementById('userBalance').textContent = currentUserData.balance.toFixed(2);

                console.log('ğŸš€ [SEKA] initializeSignalR() Ã§aÄŸÄ±rÄ±lÄ±r...');
                // SignalR baÅŸlat
                initializeSignalR();
            }
        });

        // ============================================
        // getToken funksiyasÄ±nÄ± dÉ™yiÅŸdir
        // ============================================
        function getToken() {
            return currentUserToken || "";
        }

       
        // âœ… ÆvÉ™zinÉ™ bunu É™lavÉ™ et:
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ“„ [SEKA] DOM loaded');
            setupEventListeners();
            console.log('âœ… [SEKA] Event listeners quruldu, user data gÃ¶zlÉ™nilir...');
        });



        // ==================== GLOBAL VARIABLES ====================
        let connection = null;
        let currentUserId = 0;
        let currentRoomId = null;
        let myHand = [];
        let currentTurnUserId = 0;
        let currentGameBet = 0;



        function setupEventListeners() {
            document.getElementById('foldBtn').addEventListener('click', fold);
            document.getElementById('callBtn').addEventListener('click', call);
            document.getElementById('checkBtn').addEventListener('click', check);
            document.getElementById('allInBtn').addEventListener('click', allIn);
            document.getElementById('raiseBtn').addEventListener('click', raise);
            document.getElementById('showdownBtn').addEventListener('click', requestShowdown);
            document.getElementById('leaveBtn').addEventListener('click', leaveRoom);
        }

        // function getToken() {
        //     const raw = document.cookie
        //         .split("; ")
        //         .find(row => row.startsWith("AuthToken="))
        //         ?.split("=")[1];
        //     return raw ? decodeURIComponent(raw).trim() : "";
        // }

        // ==================== SIGNALR CONNECTION ====================
        async function initializeSignalR() {
            try {
                connection = new signalR.HubConnectionBuilder()
                    .withUrl("https://nehemiah-paginal-alan.ngrok-free.dev/sekaHub", { accessTokenFactory: () => getToken() })
                    .withAutomaticReconnect()
                    .build();

                setupSignalRHandlers();
                await connection.start();
                console.log("âœ… SignalR connected");

                await loadQuickJoinButtons();
                await loadRoomList();
            } catch (error) {
                console.error("âŒ SignalR error:", error);
                showMessage("BaÄŸlantÄ± xÉ™tasÄ±: " + error.message, "error");
            }
        }

        // ==================== SIGNALR HANDLERS ====================
        function setupSignalRHandlers() {
            // User data
            connection.on("UserData", (data) => {
                currentUserId = data.userId;
                document.getElementById('userName').textContent = data.fullName;
                document.getElementById('userBalance').textContent = data.balance.toFixed(2);
            });

            connection.on("BalanceUpdated", (balance) => {
                document.getElementById('userBalance').textContent = balance.toFixed(2);
                console.log('ğŸ’° Balance updated:', balance);
            });

            // Room redirect
            connection.on("RoomRedirect", (data) => {
                const overlay = document.getElementById('redirectOverlay');
                const message = document.getElementById('redirectMessage');
                message.textContent = data.message;
                overlay.classList.add('active');
                setTimeout(() => overlay.classList.remove('active'), 3000);
            });

            // Room joining
            connection.on("JoinedRoom", (data) => {
                currentRoomId = data.roomId;
                document.getElementById('currentRoomName').textContent = data.roomName;
                document.getElementById('roomListSection').style.display = 'none';
                document.getElementById('gameSection').classList.add('active');

                if (data.hand && data.hand.length > 0) {
                    myHand = data.hand;
                    displayHand();
                }

                showMessage("OtaÄŸa qoÅŸuldunuz!", "success");
            });

            connection.on("JoinError", (message) => showMessage(message, "error"));
            connection.on("LeaveError", (message) => showMessage(message, "error"));

            connection.on("PlayerJoined", (playerName) => {
                showMessage(playerName + " qoÅŸuldu", "info");
                loadRoomList();
            });

            connection.on("PlayerLeft", (playerName) => {
                showMessage(playerName + " Ã§Ä±xdÄ±", "info");
                loadRoomList();
            });

            connection.on("PlayersList", (players) => {
                updatePlayersList(players);
                updatePlayersOnTable(players);
            });

            connection.on("PotUpdated", (amount) => {
                document.getElementById('potAmount').textContent = amount.toFixed(2);
            });

            connection.on("RoomFull", (message) => {
                showMessage(message, "info");
            });

            connection.on("RoomDeleted", (roomId) => {
                loadRoomList();
            });

            // Game events
            connection.on("GameStarted", () => {
                showMessage("Oyun baÅŸladÄ±! ğŸ®", "success");
                resetGameUI();
            });

            connection.on("CardsDealt", (data) => {
                console.log('ğŸ´ Cards received from backend:', data);
                myHand = data.hand;
                displayHand();
                showMessage("Kartlar paylandÄ±!", "info");
            });

            connection.on("GameState", (state) => {
                currentTurnUserId = state.currentTurnUserId;
                currentGameBet = state.currentBet;

                document.getElementById('potAmount').textContent = state.potAmount.toFixed(2);
                document.getElementById('currentBetAmount').textContent = state.currentBet.toFixed(2);
                document.getElementById('callAmount').textContent = state.currentBet.toFixed(2);

                updateActionButtons(state);
            });

            connection.on("PlayerBet", (data) => {
                showMessage(`${data.playerName} mÉ™rc etdi: ${data.amount}â‚¼`, "info");
            });

            connection.on("PlayerFolded", (playerName) => {
                showMessage(`${playerName} fold etdi`, "info");
            });

            connection.on("PlayerChecked", (playerName) => {
                showMessage(`${playerName} check etdi`, "info");
            });

            connection.on("PlayerAllIn", (playerName, amount) => {
                showMessage(`${playerName} ALL-IN! ${amount}â‚¼`, "success");
            });

            connection.on("BetError", (message) => showMessage(message, "error"));
            connection.on("FoldError", (message) => showMessage(message, "error"));
            connection.on("ActionError", (message) => showMessage(message, "error"));

            // Showdown
            connection.on("ShowdownStart", (players) => {
                showShowdown(players);
            });

            connection.on("ShowdownRequested", () => {
                showMessage("Showdown baÅŸlayÄ±r...", "info");
            });

            connection.on("GameOver", (data) => {
                handleGameOver(data);
            });

            connection.on("GameReset", () => {
                resetGameUI();
                showMessage("Yeni oyun Ã¼Ã§Ã¼n hazÄ±rlÄ±q...", "info");
            });

            connection.on("LeftRoom", () => {
                currentRoomId = null;
                myHand = [];
                document.getElementById('gameSection').classList.remove('active');
                document.getElementById('roomListSection').style.display = 'block';
                loadRoomList();
                showMessage("Otaqdan Ã§Ä±xdÄ±nÄ±z", "info");
            });

            // Emoji
            connection.on("PlayerEmoji", (data) => {
                showFloatingEmoji(data.userId, data.emoji);
            });
        }

        // ==================== QUICK JOIN ====================
        async function loadQuickJoinButtons() {
            try {
                const templates = await connection.invoke("GetRoomTemplates");
                const grid = document.getElementById('quickJoinGrid');

                grid.innerHTML = templates.map(t => `
            <div class="quick-join-btn" onclick="quickJoin(${t.fee})">
                <div class="name">${t.name}</div>
                <div class="fee">${t.fee}â‚¼</div>
                <div class="players">Max: ${t.maxPlayers} oyunÃ§u</div>
            </div>
        `).join('');
            } catch (error) {
                console.error("âŒ Template error:", error);
            }
        }

        async function quickJoin(entryFee) {
            try {
                await connection.invoke("QuickJoin", entryFee);
            } catch (error) {
                console.error("âŒ Quick join error:", error);
                showMessage("QoÅŸulma xÉ™tasÄ±: " + error.message, "error");
            }
        }

        // ==================== ROOM LIST ====================
        async function loadRoomList() {
            try {
                const rooms = await connection.invoke("GetRoomList");
                const grid = document.getElementById('roomGrid');

                if (rooms.length === 0) {
                    grid.innerHTML = '<div class="loading">Otaq tapÄ±lmadÄ±</div>';
                    return;
                }

                grid.innerHTML = rooms.map(room => `
            <div class="room-card ${room.isFull ? 'full' : ''}" onclick="joinRoom('${room.roomId}')">
                ${room.isDefault ? '<div class="default-badge">SYSTEM</div>' : ''}
                <h3>${room.roomName}</h3>
                <div class="room-info">
                    <span>YaradÄ±cÄ±:</span>
                    <span>${room.creatorName}</span>
                </div>
                <div class="room-info">
                    <span>OyunÃ§ular:</span>
                    <span>${room.playerCount}/${room.maxPlayers}</span>
                </div>
                <div class="room-info">
                    <span>GiriÅŸ haqqÄ±:</span>
                    <span style="color: #ffd700;">${room.entryFee}â‚¼</span>
                </div>
                <div class="room-info">
                    <span>Status:</span>
                    <span style="color: ${room.isGameStarted ? '#dc2626' : '#4ade80'};">
                        ${room.isGameStarted ? 'ğŸ”´ Oyun davam edir' : 'ğŸŸ¢ GÃ¶zlÉ™yir'}
                    </span>
                </div>
                <button class="join-btn" ${room.isFull || room.isGameStarted ? 'disabled' : ''}>
                    ${room.isFull ? 'âŒ Dolu' : 'âœ… QoÅŸul'}
                </button>
            </div>
        `).join('');
            } catch (error) {
                console.error("âŒ Room list error:", error);
            }
        }

        async function joinRoom(roomId) {
            try {
                await connection.invoke("JoinRoom", roomId, null);
            } catch (error) {
                console.error("âŒ Join error:", error);
                showMessage("QoÅŸulma xÉ™tasÄ±: " + error.message, "error");
            }
        }

        async function leaveRoom() {
            if (!currentRoomId) return;

            if (confirm("Otaqdan Ã§Ä±xmaq istÉ™diyinizdÉ™n É™minsiniz?")) {
                try {
                    await connection.invoke("LeaveRoom");
                } catch (error) {
                    console.error("âŒ Leave error:", error);
                    showMessage("Ã‡Ä±xma xÉ™tasÄ±: " + error.message, "error");
                }
            }
        }

        // ==================== GAME ACTIONS ====================
        async function fold() {
            try {
                await connection.invoke("Fold");
            } catch (error) {
                console.error("âŒ Fold error:", error);
                showMessage("Fold xÉ™tasÄ±: " + error.message, "error");
            }
        }

        async function call() {
            try {
                await connection.invoke("Call");
            } catch (error) {
                console.error("âŒ Call error:", error);
                showMessage("Call xÉ™tasÄ±: " + error.message, "error");
            }
        }

        async function check() {
            try {
                await connection.invoke("Check");
            } catch (error) {
                console.error("âŒ Check error:", error);
                showMessage("Check xÉ™tasÄ±: " + error.message, "error");
            }
        }

        async function raise() {
            const input = document.getElementById('raiseInput');
            const amount = parseFloat(input.value);

            if (!amount || amount <= 0) {
                showMessage("DÃ¼zgÃ¼n mÉ™blÉ™ÄŸ daxil edin", "error");
                return;
            }

            try {
                await connection.invoke("Raise", amount);
                input.value = '';
            } catch (error) {
                console.error("âŒ Raise error:", error);
                showMessage("Raise xÉ™tasÄ±: " + error.message, "error");
            }
        }

        async function allIn() {
            if (confirm("ALL-IN etmÉ™k istÉ™diyinizdÉ™n É™minsiniz?")) {
                try {
                    await connection.invoke("AllIn");
                } catch (error) {
                    console.error("âŒ All-in error:", error);
                    showMessage("All-in xÉ™tasÄ±: " + error.message, "error");
                }
            }
        }

        async function requestShowdown() {
            try {
                await connection.invoke("RequestShowdown");
            } catch (error) {
                console.error("âŒ Showdown error:", error);
                showMessage("Showdown xÉ™tasÄ±: " + error.message, "error");
            }
        }

        async function sendEmoji(emoji) {
            try {
                await connection.invoke("SendEmoji", emoji);
            } catch (error) {
                console.error("âŒ Emoji error:", error);
            }
        }

        // ==================== UI UPDATES ====================
        function displayHand() {
            const container = document.getElementById('handCards');
            if (!myHand || myHand.length === 0) {
                container.innerHTML = '';
                return;
            }

            // âœ… Backend artÄ±q simvollarÄ± gÃ¶ndÉ™rir, ona gÃ¶rÉ™ sadÉ™cÉ™ gÃ¶stÉ™ririk
            const getSuitClass = (suit) => {
                // Simvola gÃ¶rÉ™ class tÉ™yin edirik
                if (suit === 'â™¥') return 'hearts';
                if (suit === 'â™¦') return 'diamonds';
                if (suit === 'â™£') return 'clubs';
                if (suit === 'â™ ') return 'spades';

                // Fallback: string adlara da dÉ™stÉ™k
                const normalized = suit.toLowerCase();
                if (normalized.includes('heart') || normalized.includes('Ã¼rÉ™k')) return 'hearts';
                if (normalized.includes('diamond') || normalized.includes('karo')) return 'diamonds';
                if (normalized.includes('club') || normalized.includes('Ã§É™tÉ™nÉ™')) return 'clubs';
                if (normalized.includes('spade') || normalized.includes('pika')) return 'spades';
                return 'hearts';
            };

            container.innerHTML = myHand.map(card => `
        <div class="card ${getSuitClass(card.suit)}">
            <div class="card-rank">${card.rank}</div>
            <div class="card-suit">${card.suit}</div>
        </div>
    `).join('');

            console.log('âœ… Hand displayed:', myHand);
        }

        function updateActionButtons(state) {
            const isMyTurn = state.currentTurnUserId === currentUserId;
            const hasBet = state.currentBet > 0;

            document.getElementById('foldBtn').disabled = !isMyTurn;
            document.getElementById('callBtn').disabled = !isMyTurn || !hasBet;
            document.getElementById('checkBtn').disabled = !isMyTurn || hasBet;
            document.getElementById('raiseBtn').disabled = !isMyTurn;
            document.getElementById('raiseInput').disabled = !isMyTurn;
            document.getElementById('allInBtn').disabled = !isMyTurn;
            document.getElementById('showdownBtn').disabled = !isMyTurn;
        }

        function updatePlayersList(players) {
            const list = document.getElementById('playersList');

            list.innerHTML = players.map(p => `
        <div class="player-item">
            <div>
                <strong style="color: ${p.userId === currentUserId ? '#ffd700' : '#fff'};">
                    ${p.name}${p.userId === currentUserId ? ' (Siz)' : ''}
                </strong>
                ${p.hasFolded ? ' <span style="color: #dc2626;">[FOLD]</span>' : ''}
            </div>
            <div>
                <span style="color: #4ade80;">${p.balance.toFixed(2)}â‚¼</span>
                ${p.currentBet > 0 ? `<span style="color: #ffd700;"> | MÉ™rc: ${p.currentBet}â‚¼</span>` : ''}
            </div>
        </div>
    `).join('');
        }

        function updatePlayersOnTable(players) {
            const table = document.getElementById('pokerTable');
            const positions = ['bottom', 'left', 'top', 'right', 'top-left', 'top-right'];

            // Clear existing players
            table.querySelectorAll('.player-spot').forEach(el => el.remove());

            players.forEach((player, index) => {
                if (index >= positions.length) return;

                const spot = document.createElement('div');
                spot.className = `player-spot ${positions[index]}`;
                spot.innerHTML = `
            <div class="player-avatar ${player.isActive && !player.hasFolded ? 'active' : ''} ${player.hasFolded ? 'folded' : ''}" 
                 onclick="toggleEmojiPopup(${player.userId})">
                ${player.name.charAt(0).toUpperCase()}
                <div class="emoji-popup" id="emojiPopup${player.userId}">
                    <div class="emoji-grid">
                        <button class="emoji-btn" onclick="sendEmoji('ğŸ˜€')">ğŸ˜€</button>
                        <button class="emoji-btn" onclick="sendEmoji('ğŸ˜')">ğŸ˜</button>
                        <button class="emoji-btn" onclick="sendEmoji('ğŸ˜‚')">ğŸ˜‚</button>
                        <button class="emoji-btn" onclick="sendEmoji('ğŸ”¥')">ğŸ”¥</button>
                        <button class="emoji-btn" onclick="sendEmoji('ğŸ‘')">ğŸ‘</button>
                        <button class="emoji-btn" onclick="sendEmoji('ğŸ’ª')">ğŸ’ª</button>
                        <button class="emoji-btn" onclick="sendEmoji('ğŸ‰')">ğŸ‰</button>
                        <button class="emoji-btn" onclick="sendEmoji('â¤ï¸')">â¤ï¸</button>
                    </div>
                </div>
            </div>
            <div class="player-name">${player.name}</div>
            <div class="player-bet">${player.currentBet > 0 ? player.currentBet + 'â‚¼' : ''}</div>
        `;

                table.appendChild(spot);
            });
        }

        function toggleEmojiPopup(userId) {
            if (userId !== currentUserId) return;

            const popup = document.getElementById(`emojiPopup${userId}`);
            if (popup) {
                popup.classList.toggle('active');

                // Close after 5 seconds
                if (popup.classList.contains('active')) {
                    setTimeout(() => popup.classList.remove('active'), 5000);
                }
            }
        }

        function showFloatingEmoji(userId, emoji) {
            const spot = Array.from(document.querySelectorAll('.player-spot')).find(el => {
                const avatar = el.querySelector('.player-avatar');
                return avatar && avatar.getAttribute('onclick')?.includes(userId.toString());
            });

            if (!spot) return;

            const floater = document.createElement('div');
            floater.className = 'floating-emoji';
            floater.textContent = emoji;
            floater.style.left = '50%';
            floater.style.top = '50%';

            spot.appendChild(floater);

            setTimeout(() => floater.remove(), 2000);
        }

        // ==================== SHOWDOWN ====================
        function showShowdown(players) {
            const overlay = document.getElementById('showdownOverlay');
            const container = document.getElementById('showdownPlayers');

            const getSuitClass = (suit) => {
                if (suit === 'â™¥') return 'hearts';
                if (suit === 'â™¦') return 'diamonds';
                if (suit === 'â™£') return 'clubs';
                if (suit === 'â™ ') return 'spades';

                const normalized = suit.toLowerCase();
                if (normalized.includes('heart') || normalized.includes('Ã¼rÉ™k')) return 'hearts';
                if (normalized.includes('diamond') || normalized.includes('karo')) return 'diamonds';
                if (normalized.includes('club') || normalized.includes('Ã§É™tÉ™nÉ™')) return 'clubs';
                if (normalized.includes('spade') || normalized.includes('pika')) return 'spades';
                return 'hearts';
            };

            container.innerHTML = players.map(p => `
        <div class="showdown-player">
            <div class="showdown-player-header">
                <div class="showdown-player-name">${p.name}</div>
            </div>
            <div class="showdown-hand-name">${p.handValue?.rank || 'GÃ¶zlÉ™yin...'}</div>
            <div class="showdown-cards">
                ${p.hand.map(card => `
                    <div class="showdown-card ${getSuitClass(card.suit)}">
                        <div style="font-size: 1.8rem;">${card.rank}</div>
                        <div style="font-size: 2rem;">${card.suit}</div>
                    </div>
                `).join('')}
            </div>
        </div>
    `).join('');

            overlay.classList.add('active');
            console.log('âœ… Showdown displayed:', players);
        }

        function handleGameOver(data) {
            const winnerDiv = document.getElementById('showdownWinner');

            const getSuitClass = (suit) => {
                if (suit === 'â™¥') return 'dom';
                if (suit === 'â™¦') return 'diamonds';
                if (suit === 'â™£') return 'clubs';
                if (suit === 'â™ ') return 'spades';

                const normalized = suit.toLowerCase();
                if (normalized.includes('heart') || normalized.includes('Ã¼rÉ™k')) return 'dom';
                if (normalized.includes('diamond') || normalized.includes('karo')) return 'diamonds';
                if (normalized.includes('club') || normalized.includes('Ã§É™tÉ™nÉ™')) return 'clubs';
                if (normalized.includes('spade') || normalized.includes('pika')) return 'spades';
                return 'hearts';
            };

            if (data.results && data.results.length > 0) {
                const container = document.getElementById('showdownPlayers');

                container.innerHTML = data.results.map(p => `
            <div class="showdown-player ${p.isWinner ? 'winner' : ''}">
                <div class="showdown-player-header">
                    <div class="showdown-player-name ${p.isWinner ? 'winner' : ''}">
                        ${p.rank}. ${p.name}
                    </div>
                    ${p.isWinner ? '<div style="color: #ffd700; font-size: 2rem;">ğŸ‘‘</div>' : ''}
                </div>
                <div class="showdown-hand-name">${p.handName}</div>
                <div class="showdown-cards">
                    ${p.hand.map(card => `
                        <div class="showdown-card ${getSuitClass(card.suit)}">
                            <div style="font-size: 1.8rem;">${card.rank}</div>
                            <div style="font-size: 2rem;">${card.suit}</div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `).join('');
            }

            if (data.winners) {
                winnerDiv.innerHTML = `
            ğŸŠ QaliblÉ™r: ${data.winners.join(', ')} ğŸŠ<br>
            HÉ™r biri qazandÄ±: ${data.amount.toFixed(2)}â‚¼
            <div class="commission-info">Komissiya (20%): ${data.commission.toFixed(2)}â‚¼</div>
        `;
            } else {
                winnerDiv.innerHTML = `
            ğŸŠ Qalib: ${data.winner} ğŸŠ<br>
            Qazanc: ${data.amount.toFixed(2)}â‚¼
            <div class="commission-info">Komissiya (20%): ${data.commission.toFixed(2)}â‚¼</div>
        `;
            }

            document.getElementById('showdownOverlay').classList.add('active');
            console.log('âœ… Game Over:', data);
        }

        function closeShowdown() {
            document.getElementById('showdownOverlay').classList.remove('active');
        }

        // ==================== UTILITY ====================
        function showMessage(text, type = 'info') {
            const msg = document.createElement('div');
            msg.className = `message ${type}`;
            msg.textContent = text;
            document.body.appendChild(msg);

            setTimeout(() => msg.remove(), 4000);
        }

        function resetGameUI() {
            myHand = [];
            displayHand();

            document.getElementById('potAmount').textContent = '0';
            document.getElementById('currentBetAmount').textContent = '0';
            document.getElementById('callAmount').textContent = '0';

            const buttons = ['foldBtn', 'callBtn', 'checkBtn', 'raiseBtn', 'allInBtn', 'showdownBtn'];
            buttons.forEach(id => document.getElementById(id).disabled = true);

            document.getElementById('raiseInput').disabled = true;
            document.getElementById('raiseInput').value = '';
        }
    </script>
</body>

</html>